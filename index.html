<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Universe â†’ Saturn Hand Magic" />
    <meta property="og:description" content="hands interaction test" />
    <meta property="og:image" content="https://jonathanx7017.github.io/universe/preview.jpg?v=1" />
    <meta property="og:url" content="https://jonathanx7017.github.io/universe/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://jonathanx7017.github.io/universe/preview.jpg?v=1">
    <title>Saturn Zoom Magic</title>
    <style>
        body{margin:0;overflow:hidden;background:#000}
        #info{position:absolute;top:20px;left:20px;z-index:99;background:rgba(0,0,0,0.6);padding:12px 24px;border-radius:30px;color:#fff;font:15px system-ui;backdrop-filter:blur(8px)}
        #menu{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);z-index:99;background:rgba(15,15,25,0.9);padding:14px 32px;border-radius:50px;display:flex;gap:20px;backdrop-filter:blur(12px);border:1px solid rgba(100,160,255,0.3);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
        .btn{padding:12px 28px;background:rgba(40,40,70,0.7);color:#ddd;border:1px solid rgba(120,180,255,0.5);border-radius:30px;cursor:pointer;font:600 15px system-ui;transition:.3s}
        .btn:hover{background:rgba(80,140,255,0.4);color:#fff}
        .btn.active{background:linear-gradient(135deg,#5af,#28f);color:#fff;border:none;box-shadow:0 0 25px rgba(100,180,255,0.8)}
    </style>
</head>
<body>
<div id="info">Hands Interaction Test</div>
<div id="menu">
    <div class="btn active" data-shape="saturn">Saturn</div>
    <div class="btn" data-shape="sphere">Sphere</div>
    <div class="btn" data-shape="heart">Heart</div>
    <div class="btn" data-shape="flower">Flower</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.js" crossorigin="anonymous"></script>

<script>
    const scene=new THREE.Scene(), camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
    camera.position.z=32;
    const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
    renderer.setSize(innerWidth,innerHeight); renderer.setPixelRatio(devicePixelRatio);
    document.body.appendChild(renderer.domElement);
    scene.add(new THREE.AmbientLight(0x404040));

    const COUNT=3200, geom=new THREE.BufferGeometry();
    const pos=new Float32Array(COUNT*3), base=new Float32Array(COUNT*3), target=new Float32Array(COUNT*3);
    geom.setAttribute('position',new THREE.BufferAttribute(pos,3));

    const canvas=document.createElement('canvas'); canvas.width=canvas.height=32;
    const ctx=canvas.getContext('2d');
    const grad=ctx.createRadialGradient(16,16,0,16,16,16);
    grad.addColorStop(0,'#fff'); grad.addColorStop(0.4,'rgba(255,255,255,0.4)'); grad.addColorStop(1,'transparent');
    ctx.fillStyle=grad; ctx.fillRect(0,0,32,32);
    const tex=new THREE.CanvasTexture(canvas);
    const mat=new THREE.PointsMaterial({size:0.6,map:tex,transparent:true,opacity:0.9,depthWrite:false,blending:THREE.AdditiveBlending});
    const particles=new THREE.Points(geom,mat); scene.add(particles);

    const shapes={
        saturn:()=>{for(let i=0;i<COUNT;i++){const isBall=Math.random()<0.7; const r=isBall?6:9+Math.random()*6; const theta=Math.random()*Math.PI*2; const phi=isBall?Math.acos(2*Math.random()-1):0; const s=isBall?Math.sin(phi):0; base[i*3]=isBall?r*s*Math.cos(theta):r*Math.cos(theta); base[i*3+1]=isBall?r*s*Math.sin(theta):(Math.random()-0.5)*0.8; base[i*3+2]=isBall?r*Math.cos(phi):r*Math.sin(theta);}},
        sphere:()=>{for(let i=0;i<COUNT;i++){const u=Math.random(),v=Math.random();const theta=2*Math.PI*u,phi=Math.acos(2*v-1),r=8;const s=Math.sin(phi); base[i*3]=r*s*Math.cos(theta); base[i*3+1]=r*s*Math.sin(theta); base[i*3+2]=r*Math.cos(phi);}},
        heart:()=>{for(let i=0;i<COUNT;i++){const t=Math.random()*Math.PI*2; const x=16*Math.pow(Math.sin(t),3); const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); base[i*3]=x*0.6; base[i*3+1]=-y*0.6+2; base[i*3+2]=(Math.random()-0.5)*4;}},
        flower:()=>{for(let i=0;i<COUNT;i++){const t=Math.random()*12*Math.PI; const r=6+4*Math.cos(6*t); base[i*3]=r*Math.cos(t); base[i*3+1]=r*Math.sin(t); base[i*3+2]=(Math.random()-0.5)*6;}}
    };

    let zoom=6;
    const update=()=>{for(let i=0;i<COUNT*3;i++)target[i]=base[i]*zoom;};

    document.querySelectorAll('.btn').forEach(b=>b.onclick=()=>{
        document.querySelector('.active')?.classList.remove('active');
        b.classList.add('active');
        shapes[b.dataset.shape](); zoom=6; update();
    });

    shapes.saturn(); update();

    const video=document.createElement('video'); video.style.display='none'; document.body.appendChild(video);
    let dist=0, detected=false;
    const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/${f}`});
    hands.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.7});
    hands.onResults(r=>{detected=r.multiHandLandmarks?.length===2; if(detected)dist=Math.hypot(r.multiHandLandmarks[0][8].x-r.multiHandLandmarks[1][8].x,r.multiHandLandmarks[0][8].y-r.multiHandLandmarks[1][8].y);});
    new Camera(video,{onFrame:async()=>await hands.send({image:video}),width:640,height:480}).start();

    let t=0;
    const animate=()=>{
        requestAnimationFrame(animate); t+=0.01;
        const targetZoom=detected?Math.max(0.9,Math.min(7,(dist-0.05)*13)):6;
        zoom+=(targetZoom-zoom)*0.08; update();
        for(let i=0;i<COUNT*3;i++)pos[i]+=(target[i]-pos[i])*0.08;
        geom.attributes.position.needsUpdate=true;
        particles.rotation.y+=0.003; particles.rotation.x+=0.0008;
        mat.size=0.6+Math.sin(t*4)*0.06;
        renderer.render(scene,camera);
    };
    animate();

    window.onresize=()=>{camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight);};
</script>
</body>
</html>
